<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" type="text/css" href="../static/home.css">
    <script src="../static/script.js"></script>
    <script src="../static/recordAudio.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Simulator</title>
</head>

<body>
    <div class="session-id" id="sessionIdDisplay"></div>
    <div class="chat-container">
        <!-- Aggiunto un nuovo elemento per visualizzare l'ID di sessione -->
        
        <div class="chat-messages" id="chatMessages">
        </div>
        <div class="user-input">
            <input type="text" id="userInput" placeholder="Type your message...">
            <button onclick="sendMessage()">Send</button>
            <button id="startRecording">Start</button>
            <button id="stopRecording">Stop</button>
        </div>
        <div class="Audio">
            <p id="isRecording">Click start button to record</p>
            <audio src="" id="audioElement" controls></audio>
        </div>
        <button id="convertButton">Converti</button>
    </div>

    <script>
        function startSpeechRecognition() {
            const recognition = new webkitSpeechRecognition(); // Chrome supporta il prefisso "webkit"
            recognition.lang = 'it-IT';  // Imposta la lingua, ad esempio 'it-IT' per l'italiano

            recognition.onresult = function (event) {
                const transcript = event.results[0][0].transcript;
                console.log('Testo riconosciuto:', transcript);

                // Qui puoi inviare il testo riconosciuto al tuo server o eseguire altre operazioni
            };

            recognition.onerror = function (event) {
                console.error('Errore durante il riconoscimento vocale:', event.error);
            };

            recognition.onend = function () {
                console.log('Riconoscimento vocale terminato.');
            };

            recognition.start();
        }

        // Chiamata alla funzione quando si fa clic sul pulsante di conversione
        document.getElementById('convertButton').addEventListener('click', function () {
            startSpeechRecognition();
        });

        // Imposta l'ID di sessione nell'elemento display
        document.getElementById('sessionIdDisplay').innerText = 'sessionId: ' + getSessionId(); 

        // Funzione per ottenere l'ID di sessione dal local storage o generarne uno nuovo
        function getSessionId() {
            const storedSessionId = localStorage.getItem('sessionId');

            if (storedSessionId) {
                return storedSessionId;
            } else {
                const newSessionId = generateSessionId();
                localStorage.setItem('sessionId', newSessionId);
                return newSessionId;
            }
        }

        // Funzione per generare un nuovo ID di sessione
        function generateSessionId() {
            return Math.random().toString(36).substr(2, 9);
        }
    </script>

</body>

</html>
